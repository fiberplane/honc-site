import { css, cx } from "hono/css";
import { Wrapper } from "../components";
import { useRef, useState } from "hono/jsx";

import { useIntersectionObserver } from "../hooks";

export function HoncerAscii() {
  const preRef = useRef<HTMLPreElement>(null);
  const [isIntersecting, setIsIntersecting] = useState(false);

  useIntersectionObserver(
    preRef,
    (entries, observer) => {
      for (const entry of entries) {
        if (entry.isIntersecting) {
          setIsIntersecting(true);
          observer.disconnect();
        }
      }
    },
    { threshold: 0.9 },
  );

  return (
    <Wrapper>
      <pre
        role="img"
        aria-label="ASCII art of a person working behind a computer"
        ref={preRef}
        class={cx(preClass, isIntersecting && "fade-in")}
      >
        {/*
          We can't trim the ASCII art as it otherwise removes all whitespace
          from the first line. To prevent a layout shift after hydrating we're
          adding a whitespace character at the beginning of the ASCII art.
        */}{" "}
        {HONCER_ASCII}
      </pre>
    </Wrapper>
  );
}

const preClass = css`
  text-rendering: optimizeSpeed;
  font-family: Departure Mono, monospace;
  font-size: clamp(0.5rem, 1.4cqw, 0.75rem);
  line-height: 1;
  margin-inline: auto;
  text-align: center;
  color: transparent;
  background-clip: text;
  background-position: bottom;
  letter-spacing: 0.0em;
  background-image:
    /* geese glow */
    radial-gradient(
      circle at 50% 44em,
      var(--geese-radial-color) 4em,
      transparent var(--geese-radial-range)
    ),
    /* gradient mask */
    linear-gradient(
      to top,
      hsl(from var(--color-fg-primary) 35deg s l),
      rgb(239 114 37) 24em,
      transparent 24em
    ),
    /* screen glow */
    radial-gradient(
      circle at center 32em,
      hsl(from var(--screen-radial-color) h s 90%) 12em,
      transparent var(--screen-radial-range)
    ),
    /* background gradient */
    linear-gradient(
      hsl(from var(--color-fg-primary) 35deg s l) 10%,
      var(--color-fg-primary)
    );

  &.fade-in {
    animation: screen-entry 1.2s forwards ease-in,
      geese-entry 3s forwards ease-in;
  }
`;

const HONCER_ASCII = `
                                         -----------------                                         
                                    ----:::..............:::-----                                  
                                  --::........................::----                               
                                --::.............................:::---                            
                            ---=-:................................:::---                           
                          ------==-:................................::::---                        
                         --:..:-=+=-::::.................::......::::::::---                       
                       --:..::::=++=-:::::::::::::::::::::::::::::::::::::---                      
                      ---:::::::-=*+=--:::::::::::::::::::::::::::::::---::---                     
                     --:::::::--=*#*+==----:::::::::::-------------------------                    
                     --:::::::---=**##*++=-------------------------------------=                   
                    ---:::::-----=++=+*##*++==---------------------------------=                   
                    =--::---------++=-==+*##**++====-----------==--------------=                   
                    =-----------=*++=-----==++******++++===----=+=-------------==                  
                    =--------===-=++=------------===++++*****+==**====---------=+                  
                    +--------+#*+=--------------------------==++=**++*+--------=+                  
                    ==------+*-----==+***=:---------------+*++==--+**#*+------==+                  
                    +=----=+*=-=##*+----:::::::::::::----------=+##+-=#*+-----==                   
                    =---=+*=----:::::::::::::::::::::::::::::::------=**=---==+                    
                     +=--++-------=+==+==-:::::::::::::::::-====+=-----=*+=-===                    
                      ++=++-----=--#==@@%=--:::::::::::::--#+=%@@+:==---=*+=+++                    
                      --=+=-----.:%@*#@@@%-:-::::::::::::.#@#*@@@%+.:=--=++=--                     
                      =--+=----..-%@@@@@%#=.:-:::::::::-.:%@@@@@%#+..:--=++=--                     
                      ---==----:..=%%%%*=+...:::::::::::..-%%%%*=+:..:--==+=--                     
                      ---===----::..-=+=:..:::::::::::::::..:=+=:.::----===---                     
                       ---==-------:::::::::::::::::::::::::::::--------===--=                     
                       -====--------:::::::::::::::::::::::::::::------=====-                      
                        -====--------::::::::---:::::--::::::::--------=====                       
                        =+#+==----------:::::-===---==--::::::---------=+#+=                       
              -------------------------------------------------------------------------            
              ++++++======================================================++++++++++++=            
              +++++++++++++=========================================+++++++++++++++++++            
              ++++++++++++=+========================================+++++++++++++++++++            
              +++++++++++++=======================================+++++++++++++++++++++            
              +++++++++++++========================================++++++++++++++++++++            
              ++++++++++++++========================================+++++++++++++++++++            
              +++++++++++++++=====================================+++++++++++++++++++++            
              +++++++++++++++=====================================+++++++++++++++++++++            
              +++++++++++++++======================+=============++++++++++++++++++++++            
              +++++++++++++++=+=================================+=+++++++++++++++++++++            
              +++++++++++++++++==============ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿=========+++++++++++++++++++++++             
              ++++++++++++++++++============+ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿+========+++++++++++++++++++++++             
              +++++++++++++++++++===========+ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿+++=====++++++++++++++++++++++++             
             ##*+++++++++++++++++++=========+ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿-++=+++++++++++++++++++++++++++#%            
            ###*+++++++++++++++++++=========+ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿+++++=+++++++++++++++++++++++++#%#           
          #####*++++++++++++++++++++=======++ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿ðŸª¿+++++++++++++++++++++++++++++++##%%          
          #####*+++++++++++++++++++++++++++====+++++++++++++++++++++++++++++++++++++++++##%%%         
        ######*+++++++++++++++++++++++++++++==+++++++++++++++++++++++++++++++++++++++++###%%%        
        ########+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*####%%%       
       %########+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*####%%%      
      #########+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*#####%%%      
      %%#######*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*#####%%%      
      %%########***++*+++++++++++++++++++++++++++++++++++++++++++++++++*********+++****######%%%      
`;
